<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>FormApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      :root {
        --bg: #ffffff;
        --fg: #111111;
        --card: #f5f7fb;
        --primary: #0a84ff;
      }
      [data-theme="dark"] {
        --bg: #0f0f0f;
        --fg: #f2f2f2;
        --card: #1b1d20;
        --primary: #64b5ff;
      }
      html, body {
        margin: 0; padding: 0;
        background: var(--bg); color: var(--fg);
        font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      }
      .wrap {
        max-width: 720px; margin: 24px auto; padding: 16px;
      }
      .card {
        background: var(--card); border-radius: 12px;
        padding: 16px;
      }
      input {
        width: 100%; padding: 12px 14px; font-size: 16px;
        border: 1px solid #dcdfe5; border-radius: 8px; outline: none;
        background: #fff; color: #111;
      }
      .row { display: flex; gap: 12px; margin-top: 12px; }
      button {
        flex: 1; padding: 12px 16px; border: 0; border-radius: 10px;
        background: var(--primary); color: #fff; font-weight: 600; cursor: pointer;
      }
      .muted { font-size: 12px; opacity: .7; margin-top: 10px; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h2>Welcome to FormApp üëã</h2>
      <div class="card">
        <input id="msg" type="text" value="This message came from the Mini App!" />
        <div class="row">
          <button id="send">Send to bot</button>
          <button id="theme">Toggle theme</button>
        </div>
        <div class="muted" id="user"></div>
      </div>
    </div>

    <script>
      const tg = window.Telegram?.WebApp;
      if (tg) {
        // –¢–µ–º–∞ –ø–æ —Ç–µ–ª–µ–≥—Ä–∞–º—É
        const isDark = tg.colorScheme === "dark";
        document.documentElement.setAttribute("data-theme", isDark ? "dark" : "light");

        // –†–∞–∑–º–µ—Ä
        tg.expand();

        // –î–∞–Ω–Ω—ã–µ —é–∑–µ—Ä–∞
        const u = tg.initDataUnsafe?.user;
        if (u) {
          document.getElementById("user").textContent =
            `User: ${u.username ? '@' + u.username : (u.first_name || 'unknown')}`;
        }
      }

      document.getElementById("theme").onclick = () => {
        const cur = document.documentElement.getAttribute("data-theme") === "dark";
        document.documentElement.setAttribute("data-theme", cur ? "light" : "dark");
      };

      document.getElementById("send").onclick = () => {
        const text = document.getElementById("msg").value.trim();
        const payload = JSON.stringify({ type: "form", text });

        // –ù–ò–ß–ï–ì–û –Ω–µ —à–ª—ë–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä!
        // –¢–æ–ª—å–∫–æ sendData -> –±–æ—Ç –ø–æ–ª—É—á–∏—Ç message.web_app_data.data
        try {
          window.Telegram.WebApp.sendData(payload);
        } catch (_) {}

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ (–≤ –º–µ–Ω—é –∏ –≤ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–µ Telegram —Å–∞–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç)
        try {
          window.Telegram.WebApp.close();
        } catch (_) {}
      };
    </script>
  </body>
</html>
