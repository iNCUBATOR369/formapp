<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>FormApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #6a6a6a;
      --primary: #0a84ff;
      --primary-contrast: #ffffff;
      --card: #f5f7fb;
      --radius: 16px;
    }
    [data-theme="dark"] {
      --bg: #0e0e10;
      --fg: #e7e8ea;
      --muted: #9aa0a6;
      --primary: #4ba3ff;
      --primary-contrast: #0b1220;
      --card: #16181c;
    }
    html,body{height:100%}
    body{
      margin:0; font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--fg); background:var(--bg);
      display:flex; align-items:flex-start; justify-content:center;
    }
    .wrap{width:100%; max-width:680px; padding:24px}
    .card{
      background:var(--card); border-radius:var(--radius);
      padding:24px; box-shadow:0 1px 3px rgba(0,0,0,.06);
    }
    h1{margin:0 0 12px}
    p{margin:0 0 16px; color:var(--muted)}
    input{
      width:100%; padding:12px 14px; border-radius:12px; border:none; outline:1px solid rgba(0,0,0,.08);
      background:#fff; color:#111;
    }
    [data-theme="dark"] input{ background:#0f1115; color:#e7e8ea; outline-color:rgba(255,255,255,.08); }
    .row{display:flex; gap:12px; margin-top:12px; flex-wrap:wrap}
    button{
      cursor:pointer; border:none; border-radius:12px; padding:12px 16px;
      background:var(--primary); color:var(--primary-contrast); font-weight:600;
    }
    .ghost{ background:transparent; outline:1px solid rgba(0,0,0,.12); color:var(--fg) }
    [data-theme="dark"] .ghost{ outline-color:rgba(255,255,255,.1) }
    .hint{font-size:13px; color:var(--muted); margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Welcome to FormApp üëã</h1>
      <p>Type any text and press <b>Send to bot</b>. Close the Web App ‚Äî –±–æ—Ç –ø–æ–ª—É—á–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–≤–µ—Ç–∏—Ç –≤ —á–∞—Ç.</p>

      <input id="text" placeholder="This message came from the Mini App!" />

      <div class="row">
        <button id="send">Send to bot</button>
        <button id="theme" class="ghost">Toggle theme</button>
      </div>

      <div class="hint" id="user"></div>
      <div class="hint">Tip: –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –±–æ—Ç—É –≤ <b>–ª–∏—á–Ω—ã–π —á–∞—Ç</b> —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —ç—Ç–æ–≥–æ –æ–∫–Ω–∞.</div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π init
    try { tg?.ready(); } catch(e) {}

    // –¢–µ–º–∞
    function applyTheme(){
      const root = document.documentElement;
      root.setAttribute("data-theme", tg?.colorScheme === "dark" ? "dark" : "light");
    }
    applyTheme();
    tg?.onEvent?.("themeChanged", applyTheme);

    // –†–∞—Å—à–∏—Ä–∏–º –æ–∫–Ω–æ
    try { tg?.expand?.(); } catch(e){}

    // –ü–æ–∫–∞–∑–∞—Ç—å —é–∑–µ—Ä–∞ (–¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏)
    const u = tg?.initDataUnsafe?.user;
    document.getElementById("user").textContent = u ? `User: ${u.username ? '@'+u.username : u.first_name} (id: ${u.id})` : 'User unknown';

    // –ö–ù–û–ü–ö–ê 1: –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É (–¥–ª—è Menu Button/Keyboard)
    document.getElementById("send").onclick = () => {
      const text = document.getElementById("text").value || "This message came from the Mini App!";
      const payload = { type:"form", text, ts: Date.now() };

      // –í–ê–ñ–ù–û: –¥–ª—è Menu Button/Keyboard ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º sendData
      try {
        tg.sendData(JSON.stringify(payload));
        // –î–ª—è UX –ø–æ–∫–∞–∂–µ–º –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
        tg.showPopup({ title:"Sent", message:"Close this window to see the bot reply in chat." });
      } catch(e) {
        alert("sendData failed: " + e.message);
      }
    };

    // –ö–ù–û–ü–ö–ê 2: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    document.getElementById("theme").onclick = () => {
      const root = document.documentElement;
      const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
      root.setAttribute("data-theme", next);
    };
  </script>
</body>
</html>
